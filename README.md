# Приложение PhotoGallery

Это приложение Node.js, построенное с использованием Express, которое представляет собой фотогалерею, позволяющую пользователям загружать, хранить и просматривать изображения. Приложение использует MySQL для постоянного хранения данных и поддерживает кросс-доменные запросы (CORS).

## Структура проекта

```
├── app.js                 # Основной файл приложения, настраивает middleware Express
├── db.js                  # Конфигурация подключения к базе данных
├── init.sql              # SQL-скрипт для инициализации таблицы базы данных
├── package.json          # Зависимости проекта и скрипты
├── README.md             # Этот файл
├── bin/
│   └── www               # Точка входа в приложение, запускает HTTP-сервер
├── public/
│   ├── images/           # Директория для хранения загруженных изображений
│   └── stylesheets/
│       └── style.css     # Публичные CSS-стили
└── routes/
    └── index.js          # Обработчики маршрутов для API
└── views/
    ├── error.pug         # Шаблон страницы ошибки
    ├── index.pug         # Шаблон главной страницы
    └── layout.pug        # Базовый шаблон
```

## Зависимости

- **Express**: Веб-фреймворк для создания приложения
- **MySQL**: Драйвер базы данных для подключения к MySQL
- **Pug**: Шаблонизатор для генерации HTML
- **CORS**: Middleware для включения кросс-доменных запросов
- **Express-form-data**: Middleware для обработки multipart/form-data
- **UUID**: Библиотека для генерации уникальных идентификаторов
- **Cookie-parser**: Парсит заголовок Cookie и наполняет req.cookies
- **Morgan**: Логгер HTTP-запросов
- **Debug**: Маленькая утилита для отладки

## Схема базы данных

Приложение использует базу данных MySQL с таблицей под названием `data`, которая определена следующим образом:

```sql
CREATE TABLE IF NOT EXISTS db.`data` (
  id INT NOT NULL AUTO_INCREMENT,
  `path` varchar(255) NOT NULL,
  name varchar(255) NOT NULL,
  author varchar(255) NULL,
  description varchar(2048) NULL,
  `date` TIMESTAMP DEFAULT now() NOT NULL,
  CONSTRAINT data_PK PRIMARY KEY (id)
)
ENGINE=InnoDB
DEFAULT CHARSET=utf8mb4
COLLATE=utf8mb4_general_ci;
```

## API Маршруты

### GET /
- **Описание**: Отображает главную страницу
- **Ответ**: Отображает шаблон index.pug с заголовком 'PhotoGallery' и версией '0.1.0'

### GET /all
- **Описание**: Получает все изображения из базы данных
- **Ответ**: JSON-массив, содержащий все записи из таблицы `data`
- **Пример ответа**:
  ```
  [
    {
      id: 1,
      path: "a1b2c3d4-e5f6-7890-abcd-ef1234567890.jpg",
      name: "Закат",
      author: "Иван Иванов",
      description: "Красивое изображение заката",
      date: "2023-01-01T10:00:00.000Z"
    }
  ]
  ```

### POST /new
- **Описание**: Загружает новое изображение в галерею
- **Тело запроса**: Данные формы multipart со следующими полями:
  - `image` (обязательно): Файловый объект, содержащий изображение
  - `name` (обязательно): Название/заголовок изображения
  - `description` (опционально): Описание изображения
  - `author` (опционально): Автор изображения
- **Ответ**: При успешной загрузке возвращает сгенерированное имя файла загруженного изображения
- **Коды состояния**:
  - 200: Успешно
  - 400: Неверный запрос (отсутствует файл изображения)
  - 500: Внутренняя ошибка сервера

## Конфигурация

Приложение подключается к базе данных MySQL со следующей конфигурацией по умолчанию (определенной в db.js):
- Хост: localhost
- Пользователь: mysql
- Пароль: mysql
- База данных: db

Сервер слушает порт 3000 по умолчанию, хотя это можно изменить с помощью переменной окружения PORT.

## Запуск приложения

1. Установите зависимости: `npm install`
2. Убедитесь, что MySQL работает и база данных инициализирована с помощью init.sql
3. Запустите приложение: `npm start`
4. Откройте приложение по адресу http://localhost:3000